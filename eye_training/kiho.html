<!DOCTYPE html>
<html>
	<head>
		<title>Eye Training</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<link rel="shortcut icon" href="img/eye.ico">
		<script type="text/javascript">
			var ball_w,ball_h,margin_x, margin_y, space_h, space_w,c_ball_r,line_width;
			var step_count=0;
			var interval_procedure;
			var level;
			var finished=0;
			
			var level = location.href.substring((location.href.indexOf('level=')+6), location.href.length);
			
			document.title = document.title + " LV " + level;
			
			level *= 1;
			
			if(isNaN(level))
			    level=7;
			
		</script>
	</head>
	<body>

		<canvas id="myCanvas" width=100% height=100% >Your browser does not support the HTML5 canvas tag.</canvas>

		<script type="text/javascript">

			var canvas = document.getElementById('myCanvas'),
					context = canvas.getContext('2d');

			window.addEventListener('resize', resizeCanvas, false);

			function resizeCanvas() {
					canvas.width = window.innerWidth;
					canvas.height = window.innerHeight;
					
					ball_w=window.innerWidth * 0.02800;
					ball_h=window.innerHeight * 0.02820;
					
					margin_x=window.innerWidth * 0.10278;
					margin_y=window.innerHeight * 0.09591;
					
					space_h=window.innerHeight * 0.00888;
					space_w=window.innerWidth * 0.00250;
					
					c_ball_r=window.innerWidth * 0.00252;
					line_width=window.innerWidth * 0.00201;
					
					draw(); 
			}
			resizeCanvas();

			function draw() {
				
				switch(level){
					case 1:
						if(step_count < 160*5){
							for(var i=0;i<20;i++){
								for(var j=0;j<24;j++){
									drawBall(context,margin_x+j*(ball_w+space_w+line_width),margin_y+i*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(248,222,102)",line_width,c_ball_r);
								}
							}
							
							//160 * 5
							
							// x : (step_count % 8)
							// y :  parseInt((step_count % 160)/8)
							
							for(var i=0;i<3;i++){
								drawBall(context,margin_x+(step_count % 8)*3*(ball_w+space_w+line_width)+i*(ball_w+space_w+line_width),margin_y+parseInt((step_count % 160)/8)*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
							}
							
							//loop 5
						}else{
							if(finished==0){
								clear(context);
								clearInterval(interval_procedure);
								document.body.style.cursor = 'default';
								alert("눈을 감고 안구를 좌우로 움직이며 \n잠시 눈의 피로를 풀어줍니다.");
								finished=1;
							}
						}
						break;
					case 2:
						if(step_count < 80*4){
							for(var i=0;i<20;i++){
								for(var j=0;j<24;j++){
									drawBall(context,margin_x+j*(ball_w+space_w+line_width),margin_y+i*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(248,222,102)",line_width,c_ball_r);
								}
							}
							
							//80 * 5
							
							// x : (step_count % 4)
							// y :  parseInt((step_count % 80)/4)
							
							for(var i=0;i<6;i++){
								drawBall(context,margin_x+(step_count % 4)*6*(ball_w+space_w+line_width)+i*(ball_w+space_w+line_width),margin_y+parseInt((step_count % 80)/4)*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
							}
							
							//loop 5
						}else{
							if(finished==0){
								clear(context);
								clearInterval(interval_procedure);
								document.body.style.cursor = 'default';
								alert("눈을 감고 안구를 좌우로 움직이며 \n잠시 눈의 피로를 풀어줍니다.");
								finished=1;
							}
						}
						break;
					case 3:
						if(step_count < 40*5){
							for(var i=0;i<20;i++){
								for(var j=0;j<24;j++){
									drawBall(context,margin_x+j*(ball_w+space_w+line_width),margin_y+i*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(248,222,102)",line_width,c_ball_r);
								}
							}
							
							//40 * 5
							
							// x : (step_count % 2)
							// y :  parseInt((step_count % 40)/2)
							
							for(var i=0;i<12;i++){
								drawBall(context,margin_x+(step_count % 2)*12*(ball_w+space_w+line_width)+i*(ball_w+space_w+line_width),margin_y+parseInt((step_count % 40)/2)*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
							}
							
							//loop 5
						}else{
							if(finished==0){
								clear(context);
								clearInterval(interval_procedure);
								document.body.style.cursor = 'default';
								alert("눈을 감고 안구를 좌우로 움직이며 \n잠시 눈의 피로를 풀어줍니다.");
								finished=1;
							}
						}
						break;
					case 4:
						if(step_count < 40*11){
							for(var i=0;i<20;i++){
								for(var j=0;j<24;j++){
									drawBall(context,margin_x+j*(ball_w+space_w+line_width),margin_y+i*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(248,222,102)",line_width,c_ball_r);
								}
							}
							
							//40 * 5
							
							// x : (step_count % 2)
							// y :  parseInt((step_count % 40)/2)
							
							for(var i=0;i<12;i++){
								drawBall(context,margin_x+(step_count % 2)*12*(ball_w+space_w+line_width)+i*(ball_w+space_w+line_width),margin_y+parseInt((step_count % 40)/2)*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
							}
							
							//loop 5
						}else{
							if(finished==0){
								clear(context);
								clearInterval(interval_procedure);
								document.body.style.cursor = 'default';
								alert("눈을 감고 안구를 좌우로 움직이며 \n잠시 눈의 피로를 풀어줍니다.");
								finished=1;
							}
						}
						break;
					case 5:
						//loop 18 : working
						if(step_count < 80*18){
							for(var i=0;i<20;i++){
								for(var j=0;j<24;j++){
									drawBall(context,margin_x+j*(ball_w+space_w+line_width),margin_y+i*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(248,222,102)",line_width,c_ball_r);
								}
							}
							
							//80 * 5
							
							// x : (step_count % 4)
							// y :  parseInt((step_count % 80)/2)
							
							for(var i=0;i<10;i++){
								if(step_count % 4 !=3){
									drawBall(context,margin_x+(step_count % 4)*5*(ball_w+space_w+line_width)+i*(ball_w+space_w+line_width),margin_y+parseInt((step_count % 80)/4)*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
								}else{
									drawBall(context,margin_x+14*(ball_w+space_w+line_width)+i*(ball_w+space_w+line_width),margin_y+parseInt((step_count % 80)/4)*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
								}
								
							}
							
							//loop 5
						}else{
							if(finished==0){
								clear(context);
								clearInterval(interval_procedure);
								document.body.style.cursor = 'default';
								alert("눈을 감고 안구를 좌우로 움직이며 \n잠시 눈의 피로를 풀어줍니다.");
								finished=1;
							}
						}
						break;
					case 6:
						if(step_count < 20*21){
							for(var i=0;i<20;i++){
								for(var j=0;j<24;j++){
									drawBall(context,margin_x+j*(ball_w+space_w+line_width),margin_y+i*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(248,222,102)",line_width,c_ball_r);
								}
							}
							
							//20 * 5
							
							// x : step_count
							// y :  parseInt((step_count % 20)/2)
							
							for(var i=0;i<24;i++){
								drawBall(context,margin_x+i*(ball_w+space_w+line_width),margin_y+(step_count % 20)*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
							}
							
							//loop 5
						}else{
							if(finished==0){
								clear(context);
								clearInterval(interval_procedure);
								document.body.style.cursor = 'default';
								alert("눈을 감고 안구를 좌우로 움직이며 \n잠시 눈의 피로를 풀어줍니다.");
								finished=1;
							}
						}
						break;
					case 7:
						if(step_count < 10*14){
							for(var i=0;i<20;i++){
								for(var j=0;j<24;j++){
									drawBall(context,margin_x+j*(ball_w+space_w+line_width),margin_y+i*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(248,222,102)",line_width,c_ball_r);
								}
							}
							
							//20 * 5
							
							// x : step_count
							// y :  parseInt((step_count % 20)/2)
							
							for(var i=0;i<24;i++){
								drawBall(context,margin_x+i*(ball_w+space_w+line_width),margin_y+(step_count % 10)*2*(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
								drawBall(context,margin_x+i*(ball_w+space_w+line_width),margin_y+(step_count % 10)*2*(ball_h+space_h+line_width)+(ball_h+space_h+line_width),ball_w,ball_h,"rgb(0,102,0)",line_width,c_ball_r);
							}
							
							//loop 5
						}else{
							if(finished==0){
								clear(context);
								clearInterval(interval_procedure);
								document.body.style.cursor = 'default';
								alert("눈을 감고 안구를 좌우로 움직이며 \n잠시 눈의 피로를 풀어줍니다.");
								finished=1;
							}
						}
						break;
				}
				
				
				
				
				
			}
			function drawEllipse(ctx, x, y, w, h,c,line_w) {
			  var kappa = .5522848;
				  ox = (w / 2) * kappa, // control point offset horizontal
				  oy = (h / 2) * kappa, // control point offset vertical
				  xe = x + w,           // x-end
				  ye = y + h,           // y-end
				  xm = x + w / 2,       // x-middle
				  ym = y + h / 2;       // y-middle

			  ctx.beginPath();
			  ctx.moveTo(x, ym);
			  ctx.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);
			  ctx.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);
			  ctx.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);
			  ctx.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);
			  ctx.lineWidth = line_w;
			  ctx.closePath();
			  ctx.strokeStyle = c;
			  ctx.stroke();
			}


			function clear(ctx){
				
					ctx.save();

					// Use the identity matrix while clearing the canvas
					ctx.setTransform(1, 0, 0, 1, 0, 0);
					ctx.clearRect(0, 0, canvas.width, canvas.height);

					// Restore the transform
					ctx.restore();
			}
			
			function drawBall(ctx,x,y,w,h,c,line_w,center_r){
				drawEllipse(ctx,x,y,w,h,c,line_w);
				
				ctx.beginPath();
				ctx.arc(x+w/2,y+h/2,center_r,0,2*Math.PI);
				ctx.fillStyle = c;
				ctx.fill();
				
			}
			
			function countStep(){
				++step_count;
				draw();
			}
			
		//step_count
		//1000 = 1 sec
		document.body.style.cursor = 'none';
		alert("Ready!!");
		
		/*
			250
			250
			333
			250
			95
			416
			416
		*/
		var tick_time;
		
		switch(level){
			case 1:
				tick_time=250;
				break;
			case 2:
				tick_time=250;
				break;
			case 3:
				tick_time=333;
				break;
			case 4:
				tick_time=250;
				break;
			case 5:
				tick_time=95;
				break;
			case 6:
				tick_time=416;
				break;
			case 7:
				tick_time=250;
				break;
		}
		
		interval_procedure=setInterval("countStep()", tick_time);
		

		</script> 
		
	</body>
</html>

